name: Discord Webhook Notification

on:
  push:
    branches:
      - main
  pull_request:
    types: [opened, closed, reopened]
  pull_request_review:
    types: [submitted, edited, dismissed]
  issues:
    types: [opened, closed, reopened]
  release:
    types: [published, edited, released]
  check_run:
    types: [completed]
  check_suite:
    types: [completed]
  deployment:
    types: [created, completed]

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Check if Discord webhook URL is set
        run: |
          if [ -z "${{ secrets.DISCORD_WEBHOOK_URL }}" ]; then
            echo "Error: DISCORD_WEBHOOK_URL secret is not set"
            exit 1
          fi

      - name: Send notification to Discord for Push
        if: github.event_name == 'push'
        run: |
          curl -X POST \
               -H "Content-Type: application/json" \
               -d "{\"content\": \"üöÄ **Push Event** in \`${{ github.repository }}\` by **${{ github.actor }}**\\n\\nBranch: \`${{ github.ref_name }}\`\\nCommit: [\`${{ github.sha }}\`](${{ github.event.head_commit.url }})\"}" \
               "${{ secrets.DISCORD_WEBHOOK_URL }}"

      - name: Send notification to Discord for Pull Request
        if: github.event_name == 'pull_request'
        run: |
          ACTION="${{ github.event.action }}"
          PR_NUMBER="${{ github.event.pull_request.number }}"
          PR_TITLE="${{ github.event.pull_request.title }}"
          PR_URL="${{ github.event.pull_request.html_url }}"

          curl -X POST \
               -H "Content-Type: application/json" \
               -d "{\"content\": \"üìã **Pull Request ${ACTION^}** in \`${{ github.repository }}\` by **${{ github.actor }}**\\n\\n[#${PR_NUMBER}: ${PR_TITLE}](${PR_URL})\"}" \
               "${{ secrets.DISCORD_WEBHOOK_URL }}"

      - name: Send notification to Discord for Pull Request Review
        if: github.event_name == 'pull_request_review'
        run: |
          REVIEW_STATE="${{ github.event.review.state }}"
          PR_NUMBER="${{ github.event.pull_request.number }}"
          PR_TITLE="${{ github.event.pull_request.title }}"
          PR_URL="${{ github.event.pull_request.html_url }}"

          curl -X POST \
               -H "Content-Type: application/json" \
               -d "{\"content\": \"üëÄ **Pull Request Review ${REVIEW_STATE^}** in \`${{ github.repository }}\` by **${{ github.actor }}**\\n\\n[#${PR_NUMBER}: ${PR_TITLE}](${PR_URL})\"}" \
               "${{ secrets.DISCORD_WEBHOOK_URL }}"

      - name: Send notification to Discord for Issues
        if: github.event_name == 'issues'
        run: |
          ACTION="${{ github.event.action }}"
          ISSUE_NUMBER="${{ github.event.issue.number }}"
          ISSUE_TITLE="${{ github.event.issue.title }}"
          ISSUE_URL="${{ github.event.issue.html_url }}"

          curl -X POST \
               -H "Content-Type: application/json" \
               -d "{\"content\": \"üêõ **Issue ${ACTION^}** in \`${{ github.repository }}\` by **${{ github.actor }}**\\n\\n[#${ISSUE_NUMBER}: ${ISSUE_TITLE}](${ISSUE_URL})\"}" \
               "${{ secrets.DISCORD_WEBHOOK_URL }}"

      - name: Send notification to Discord for Release
        if: github.event_name == 'release'
        run: |
          ACTION="${{ github.event.action }}"
          RELEASE_NAME="${{ github.event.release.name }}"
          RELEASE_TAG="${{ github.event.release.tag_name }}"
          RELEASE_URL="${{ github.event.release.html_url }}"

          curl -X POST \
               -H "Content-Type: application/json" \
               -d "{\"content\": \"üéâ **Release ${ACTION^}** in \`${{ github.repository }}\`\\n\\n[${RELEASE_NAME} (${RELEASE_TAG})](${RELEASE_URL})\"}" \
               "${{ secrets.DISCORD_WEBHOOK_URL }}"

      - name: Send notification to Discord for Check Run
        if: github.event_name == 'check_run'
        run: |
          CHECK_NAME="${{ github.event.check_run.name }}"
          CHECK_STATUS="${{ github.event.check_run.status }}"
          CHECK_CONCLUSION="${{ github.event.check_run.conclusion }}"

          curl -X POST \
               -H "Content-Type: application/json" \
               -d "{\"content\": \"‚úÖ **Check Run Completed** in \`${{ github.repository }}\`\\n\\nCheck: \`${CHECK_NAME}\`\\nStatus: ${CHECK_STATUS}\\nResult: ${CHECK_CONCLUSION}\"}" \
               "${{ secrets.DISCORD_WEBHOOK_URL }}"

      - name: Send notification to Discord for Check Suite
        if: github.event_name == 'check_suite'
        run: |
          CHECK_STATUS="${{ github.event.check_suite.status }}"
          CHECK_CONCLUSION="${{ github.event.check_suite.conclusion }}"

          curl -X POST \
               -H "Content-Type: application/json" \
               -d "{\"content\": \"üìä **Check Suite Completed** in \`${{ github.repository }}\`\\n\\nStatus: ${CHECK_STATUS}\\nResult: ${CHECK_CONCLUSION}\"}" \
               "${{ secrets.DISCORD_WEBHOOK_URL }}"

      - name: Send notification to Discord for Deployment
        if: github.event_name == 'deployment'
        run: |
          DEPLOY_ENV="${{ github.event.deployment.environment }}"

          curl -X POST \
               -H "Content-Type: application/json" \
               -d "{\"content\": \"üöÄ **Deployment Event** in \`${{ github.repository }}\`\\n\\nEnvironment: \`${DEPLOY_ENV}\`\"}" \
               "${{ secrets.DISCORD_WEBHOOK_URL }}"
